<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Deploying an Elixir app to Google App Engine · Blog</title><meta name="description" content="Deploying an Elixir app to Google App Engine - Ben Sarmiento"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/ben-sketch-green.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/ben-sketch-green.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://bensarmiento.com" target="_blank" class="nav-list-link">MOTHERSHIP</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Deploying an Elixir app to Google App Engine</h1><div class="post-info">Jul 19, 2016</div><div class="post-content"><p>I’ve been hearing a lot of good things about <a href="http://elixir-lang.org/" target="_blank" rel="external">Elixir</a> lately so I thought of trying it out and making it work with <a href="https://cloud.google.com/appengine/docs/flexible/" target="_blank" rel="external">Google App Engine</a>. This post has nothing about these good things though; I’ve been reading and practicing a lot of functional programming lately and I recommend everyone to check it out.</p>
<p>To start, you need to install Elixir. Instructions are described <a href="http://elixir-lang.org/install.html" target="_blank" rel="external">here</a> to set it up. I am running Ubuntu 14.04 so I had to do run these commands:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">wget https://packages.erlang-solutions.com/erlang-solutions_1.0_all.deb &amp;&amp; sudo dpkg -i erlang-solutions_1.0_all.deb</div><div class="line">sudo apt-get update</div><div class="line">sudo apt-get install esl-erlang</div><div class="line">sudo apt-get install elixir</div></pre></td></tr></table></figure>
<p>Next, I am going to use <a href="http://www.phoenixframework.org/" target="_blank" rel="external">Phoenix</a> to create a basic web app. To use it, you need to install it as well; instructions are <a href="http://www.phoenixframework.org/docs/installation" target="_blank" rel="external">here</a>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mix local.hex # install Hex package manager</div><div class="line">mix archive.install https://github.com/phoenixframework/archives/raw/master/phoenix_new.ez</div></pre></td></tr></table></figure>
<p>Once done, we can start creating Phoenix projects. For our purpose, let’s just create a minimal setup.</p>
<p><code>mix phoenix.new gaetest --no-brunch --no-ecto</code></p>
<p>This command will setup a Phoenix project in <strong>gaetest</strong>. You can run <code>mix phoenix.server</code> inside that directory to run your app. In some cases, you may also need to install <a href="https://nodejs.org/" target="_blank" rel="external">Node</a>.</p>
<p>We have to make some config updates to our Phoenix project so we can run it inside GAE. First, add <a href="https://github.com/bitwalker/exrm" target="_blank" rel="external">exrm</a> as a dependency. Open <code>mix.exs</code> and add this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">defp deps do</div><div class="line">  [&#123;:phoenix, &quot;~&gt; 1.2.0&quot;&#125;,</div><div class="line">   ...</div><div class="line">   &#123;:exrm, &quot;~&gt; 1.0.8&quot;&#125;]</div><div class="line">end</div></pre></td></tr></table></figure>
<p>Next, we configure our production release to run as a server in port 8080. To do this, open <code>config/prod.exs</code> and change it like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">config :gaetest, Gaetest.Endpoint,</div><div class="line">  http: [port: 8080],</div><div class="line">  url: [host: &quot;example.com&quot;],</div><div class="line">  cache_static_manifest: &quot;priv/static/manifest.json&quot;,</div><div class="line">  server: true</div></pre></td></tr></table></figure>
<p>Then, onto our GAE setup, we’ll be using a <a href="https://cloud.google.com/appengine/docs/flexible/custom-runtimes/" target="_blank" rel="external">custom runtime</a> as Elixir is not natively supported. We need to install <a href="https://cloud.google.com/sdk/" target="_blank" rel="external">Cloud SDK</a> and <a href="https://www.docker.com/" target="_blank" rel="external">Docker</a> for this. Run <code>gcloud init</code> if this is your first time installing Cloud SDK. To make sure everything is ready, run <a href="https://cloud.google.com/sdk/gcloud/reference/preview/app/" target="_blank" rel="external"><em>gcloud app –help</em></a> and <em>docker -v</em>.</p>
<p>Inside the <strong>gaetest</strong> directory, create <em>app.yaml</em> to configure our project to use a custom runtime:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># app.yaml</div><div class="line"></div><div class="line">runtime: custom</div><div class="line">vm: true</div></pre></td></tr></table></figure>
<p>Next, we’ll create a <em>Dockerfile</em> to describe how to run our app inside GAE. We need to build a release inside our container, hence the <code>mix</code> commands.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"># Dockerfile</div><div class="line"></div><div class="line">FROM trenpixster/elixir</div><div class="line"></div><div class="line">ENV VERSION 0.0.1</div><div class="line">ENV APP_HOST 8080</div><div class="line">ENV MIX_ENV prod</div><div class="line">EXPOSE $APP_HOST</div><div class="line"></div><div class="line">RUN mkdir /app</div><div class="line">COPY . /app/</div><div class="line"></div><div class="line">WORKDIR /app</div><div class="line">RUN mix do deps.get, compile</div><div class="line">RUN mix phoenix.digest</div><div class="line">RUN mix compile</div><div class="line">RUN mix release</div><div class="line"></div><div class="line">WORKDIR /app/rel/gaetest/releases/$VERSION</div><div class="line">ENTRYPOINT [&quot;./gaetest.sh&quot;]</div><div class="line">CMD [&quot;foreground&quot;]</div></pre></td></tr></table></figure>
<p>You can use other base Docker images that provide Elixir runtime, I chose <a href="https://hub.docker.com/r/trenpixster/elixir/" target="_blank" rel="external">trenpixster/elixir</a> for this example but it should run just the same.</p>
<p>Last step is deploying to GAE. If you haven’t created a GCP project yet, you need to <a href="https://console.cloud.google.com/" target="_blank" rel="external">create one</a> and get the project ID. <em>You need to have billing enabled in your GCP project to use Flexible Environments.</em> Now run <code>gcloud app deploy --project=PROJECTID --version=VERSION app.yaml</code> to deploy your Elixir app. <code>VERSION</code> is just an arbitrary string. At the end of everything, your app should be available at <code>http://projectid.appspot.com</code>. Enjoy!</p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/07/11/IPTV-is-the-Answer/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'bensarmiento';
var disqus_identifier = '2016/07/19/Deploying-an-Elixir-app-to-Google-App-Engine/';
var disqus_title = 'Deploying an Elixir app to Google App Engine';
var disqus_url = 'https://blog.bensarmiento.com/2016/07/19/Deploying-an-Elixir-app-to-Google-App-Engine/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//bensarmiento.disqus.com/count.js" async></script><div class="copyright"><p>© 2016 <a href="https://blog.bensarmiento.com">Ben Sarmiento</a>, unless otherwise noted.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-80507391-2",'auto');ga('send','pageview');</script></body></html>